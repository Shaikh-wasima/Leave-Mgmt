@{
    ViewData["Title"] = "Index";
}
<div class="row">
    <div class="col-6">
        <h2 class="text-primary">List Of Employee </h2>
    </div>
    
    <div class="col-6 text-right">
        
        <a class="btn btn-success" asp-controller="LeaveAllocations" asp-action="CreateEmployee"><i class="fas fa-plus"></i> &nbsp; Create New Employee</a>
        <button id="exportButton" class="btn btn-primary">
            <i class="fas fa-download"></i> Export to CSV
        </button>
    </div>
</div>
<br />
<div class="p-4 border rounded">
    <table id="tblData" class="table table-striped table-bordered" style="width:100%">
        <thead class="thead-dark">
            <tr class="table-info">
                <th>
                    First Name
                </th>
                <th>
                    Last Name
                </th>
                <th>
                    Email
                </th>
                <th>
                    Role
                </th>
                <th>
                    AssignedManager
                </th>
                
                
               
                <th>Action</th>
               
                

                
            </tr>
        </thead>

    </table>
</div>

@section Scripts{
    <script src="~/js/LeaveAllocation.js"></script>
    <script>
        $(function () {
            var save = '@TempData["result"]';
            if (save != null && save != '') {
                if (save == "Update") {
                    toastr.info('Update Operation Successfully');
                }
                else toastr.success('Successfully Created Leave Type');
            }

        })






    </script>


    <script>
        $(document).ready(function () {
            $('#exportButton').click(function () {
                // Make an AJAX request to fetch the JSON data
                $.ajax({
                    url: "/LeaveAllocations/GetAll",
                    type: "GET",
                    success: function (response) {
                        // Extract headers from the first object in the data array
                        var headers = Object.keys(response.data[0]);

                        // Extract data from the JSON
                        var tableData = [];
                        response.data.forEach(function (item) {
                            var rowData = [];
                            headers.forEach(function (header) {
                                rowData.push(item[header]);
                            });
                            tableData.push(rowData);
                        });

                        // Create a CSV content
                        var csvContent = "data:text/csv;charset=utf-8,";
                        csvContent += headers.join(",") + "\r\n";
                        tableData.forEach(function (rowArray) {
                            var row = rowArray.join(",");
                            csvContent += row + "\r\n";
                        });

                        // Create a download link and click it to start downloading
                        var encodedUri = encodeURI(csvContent);
                        var link = document.createElement("a");
                        link.setAttribute("href", encodedUri);
                        link.setAttribute("download", "data.csv");
                        document.body.appendChild(link);
                        link.click();
                    },
                    error: function (xhr, status, error) {
                        console.error("Error occurred while fetching data:", error);
                    }
                });
            });
        });

    </script>
}