@model EventCalendarVM;
@using Leave_Management.Data;
@using Leave_Management.Contracts;
@using Microsoft.AspNetCore.Identity;
@inject IUnitOfWork _uow;

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<div id="calendar"></div>

<!-- Modal -->
<div id="myModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Event</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="eventForm">
                    <div class="form-group">
                        <label for="eventTitle">Event Title:</label>
                        <input type="text" class="form-control" id="eventTitle" name="eventTitle">
                    </div>
                    <div class="form-group">
                        <label for="startDate">Start Date:</label>
                        <input type="text" class="form-control" id="startDate" name="startDate">
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date:</label>
                        <input type="text" class="form-control" id="endDate" name="endDate">
                    </div>
                    <button type="submit" id="submitBtn" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var today = new Date().toISOString().slice(0, 10);

        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            validRange: {
                start: today
            },
            select: function (info) {
                var startDate = info.startStr;
                var endDate = info.endStr;
                openModal(startDate, endDate);
            }
        });

        calendar.render();

        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        };

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        async function openModal(startDate, endDate) {
            var startDateInput = document.getElementById("startDate");
            var endDateInput = document.getElementById("endDate");
            startDateInput.value = startDate;
            endDateInput.value = endDate;
            modal.style.display = "block";

            // Handle form submission
            var submitBtn = document.getElementById("submitBtn");
            submitBtn.onclick = function () {
                var title = document.getElementById("eventTitle").value;
                if (title.trim() !== '') {
                    // Split date range and create events for each day
                    var start = new Date(startDate);
                    var end = new Date(endDate);
                    while (start <= end) {
                        calendar.addEvent({
                            title: title,
                            start: start,
                            allDay: true
                        });
                        start.setDate(start.getDate() + 1);
                    }

                 



                    //fetch post to event calendar controller and addevent action method
                    calendar.render();
                    modal.style.display = "none";
                } else {
                    alert("Please enter event title!");
                }
                return false; // Prevent form submission
            };
        }
    });
</script>


